<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.6.0.final using JasperReports Library version 6.6.0  -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="reporteCajaResumido" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="6baf4be4-b0be-4baa-bdf2-b0ee4773dfe7">
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="conexion postgresq"/>
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<property name="com.jaspersoft.studio.data.sql.SQLQueryDesigner.sash.w1" value="200"/>
	<property name="com.jaspersoft.studio.data.sql.SQLQueryDesigner.sash.w2" value="792"/>
	<parameter name="FECHA_INICIO" class="java.sql.Date"/>
	<parameter name="FECHA_FIN" class="java.sql.Date"/>
	<queryString>
		<![CDATA[select 'Ingreso' as tipo, 'INSTALACION' as proceso,case when sum(fd.subtotal) is null then 0 else sum(fd.subtotal) end as total, ((select case when sum (fa.total_factura) is null 
then 0 else  sum (fa.total_factura) end from factura fa where fa.estado = 'A' and fa.fecha between $P{FECHA_INICIO} and $P{FECHA_FIN} ) - (select case when sum(eg.monto) is null
then 0 else sum(eg.monto) end from egreso eg where eg.estado = 'A' and eg.fecha between  $P{FECHA_INICIO}  and  $P{FECHA_FIN}  )) as diferencia
from factura f,factura_detalle fd,planilla p,planilla_detalle pd where f.estado = 'A' and f.id_factura = fd.id_factura and p.id_planilla = fd.id_planilla 
and pd.id_planilla = p.id_planilla and pd.identificador_operacion = 'INS' and p.convenio = 'NO'
and f.fecha between  $P{FECHA_INICIO}  and  $P{FECHA_FIN} 

union all 

select 'Ingreso' as tipo, 'REPARACION' as proceso,case when sum(fd.subtotal) is null then 0 else sum(fd.subtotal) end as total, ((select case when sum (fa.total_factura) is null 
then 0 else  sum (fa.total_factura) end from factura fa where fa.estado = 'A' and fa.fecha between  $P{FECHA_INICIO}  and $P{FECHA_FIN} ) - (select case when sum(eg.monto) is null
then 0 else sum(eg.monto) end from egreso eg where eg.estado = 'A' and eg.fecha between  $P{FECHA_INICIO}  and   $P{FECHA_FIN} )) as diferencia
from factura f,factura_detalle fd,planilla p,planilla_detalle pd where f.estado = 'A' and f.id_factura = fd.id_factura and p.id_planilla = fd.id_planilla 
and pd.id_planilla = p.id_planilla and pd.identificador_operacion = 'REP' and p.convenio = 'NO'
and f.fecha between  $P{FECHA_INICIO} and  $P{FECHA_FIN} 

union all 

select 'Ingreso' as tipo, 'CONSUMO DE AGUA' as proceso,case when sum(fd.subtotal) is null then 0 else sum(fd.subtotal) end as total, ((select case when sum (fa.total_factura) is null 
then 0 else  sum (fa.total_factura) end from factura fa where fa.estado = 'A' and fa.fecha between  $P{FECHA_INICIO} and  $P{FECHA_FIN}  ) - (select case when sum(eg.monto) is null
then 0 else sum(eg.monto) end from egreso eg where eg.estado = 'A' and eg.fecha between  $P{FECHA_INICIO}  and  $P{FECHA_FIN} )) as diferencia
from factura f,factura_detalle fd,planilla p,planilla_detalle pd where f.estado = 'A' and f.id_factura = fd.id_factura and p.id_planilla = fd.id_planilla 
and pd.id_planilla = p.id_planilla and pd.identificador_operacion = 'LEC' and p.convenio = 'NO'
and f.fecha between   $P{FECHA_INICIO} and  $P{FECHA_FIN} 

union all

select 'Egreso' as tipo, '' as proceso,case when sum(e.monto) is null then 0 else sum(e.monto) end as total,
((select case when sum (fa.total_factura) is null 
then 0 else  sum (fa.total_factura) end from factura fa
where fa.estado = 'A' and fa.fecha between  $P{FECHA_INICIO} 
and   $P{FECHA_FIN} ) - (select case when sum(eg.monto) is null 	
then 0 else sum(eg.monto) end from
egreso eg where eg.estado = 'A' and eg.fecha 
between  $P{FECHA_INICIO} and  $P{FECHA_FIN} )) as diferencia
from egreso e
where e.estado = 'A'
and e.fecha between  $P{FECHA_INICIO}  and  $P{FECHA_FIN} 
group by tipo,proceso

union all 

select 'Egreso' as tipo, '' as proceso,0 as total,
((select case when sum (fa.total_factura) is null 
then 0 else  sum (fa.total_factura) end from factura fa
where fa.estado = 'A' and fa.fecha between  $P{FECHA_INICIO} 
and   $P{FECHA_FIN} ) - (select case when sum(eg.monto) is null 	
then 0 else sum(eg.monto) end from
egreso eg where eg.estado = 'A' and eg.fecha 
between  $P{FECHA_INICIO} and  $P{FECHA_FIN} )) as diferencia
where (select count(*) from egreso e where e.estado = 'A') = 0]]>
	</queryString>
	<field name="tipo" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.label" value="tipo"/>
	</field>
	<field name="proceso" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.label" value="proceso"/>
	</field>
	<field name="total" class="java.lang.Double">
		<property name="com.jaspersoft.studio.field.label" value="total"/>
	</field>
	<field name="diferencia" class="java.lang.Double">
		<property name="com.jaspersoft.studio.field.label" value="diferencia"/>
	</field>
	<group name="Group1">
		<groupExpression><![CDATA[$F{tipo}]]></groupExpression>
		<groupFooter>
			<band/>
		</groupFooter>
	</group>
	<group name="Group2">
		<groupExpression><![CDATA[$F{tipo}]]></groupExpression>
		<groupHeader>
			<band height="70">
				<textField>
					<reportElement x="53" y="34" width="100" height="30" uuid="f6ba332d-91ea-4231-b53a-cd63416baa0e"/>
					<textFieldExpression><![CDATA[$F{tipo}]]></textFieldExpression>
				</textField>
			</band>
		</groupHeader>
		<groupFooter>
			<band height="50"/>
		</groupFooter>
	</group>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="89" splitType="Stretch">
			<rectangle>
				<reportElement x="0" y="0" width="555" height="80" uuid="f39a5074-7672-4d16-94a5-c49c33e96edb"/>
			</rectangle>
			<line>
				<reportElement x="180" y="0" width="1" height="80" uuid="cf68ad76-12ff-4b8d-bbd1-54aa4db0dfb9"/>
			</line>
			<staticText>
				<reportElement x="13" y="50" width="150" height="10" uuid="d3faa0a5-3876-43f7-b5a0-14b638ed2f8e"/>
				<textElement textAlignment="Center">
					<font fontName="Arial" size="7"/>
				</textElement>
				<text><![CDATA[Junta Administradora de Agua Potable]]></text>
			</staticText>
			<staticText>
				<reportElement x="13" y="60" width="150" height="10" uuid="51372ced-1e97-40e2-b68d-c7816ed06eb1"/>
				<textElement textAlignment="Center">
					<font fontName="Arial" size="7"/>
				</textElement>
				<text><![CDATA[Zapotal - Santa Elena]]></text>
			</staticText>
			<staticText>
				<reportElement x="13" y="70" width="150" height="10" uuid="44f4d449-801d-415b-ab53-744e04e44956"/>
				<textElement textAlignment="Center">
					<font fontName="Arial" size="7"/>
				</textElement>
				<text><![CDATA[RUC.: 2490016034001]]></text>
			</staticText>
			<staticText>
				<reportElement x="200" y="11" width="60" height="14" uuid="54f73c03-8b3b-45aa-a675-6521df6c6cac"/>
				<textElement>
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<text><![CDATA[Reporte:]]></text>
			</staticText>
			<staticText>
				<reportElement x="270" y="12" width="240" height="14" uuid="db784b57-cf34-4efa-8be3-08441e33ad60"/>
				<textElement>
					<font fontName="Bookman Old Style" isBold="false"/>
				</textElement>
				<text><![CDATA[Reporte de caja - Resumido]]></text>
			</staticText>
			<staticText>
				<reportElement x="200" y="52" width="60" height="14" uuid="d1adb1bf-cadd-4a82-9d47-3c553bf0aac2"/>
				<textElement>
					<font fontName="Arial" isBold="true"/>
				</textElement>
				<text><![CDATA[Fecha:]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy h:mm a">
				<reportElement x="270" y="53" width="100" height="13" uuid="61b9cd28-6bf0-4249-9535-7ac4b0858c2d"/>
				<textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
			</textField>
		</band>
	</title>
	<pageHeader>
		<band height="35" splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="40" splitType="Stretch"/>
	</columnHeader>
	<detail>
		<band height="68" splitType="Stretch">
			<textField>
				<reportElement x="127" y="23" width="100" height="30" uuid="e51ca5fa-1a25-4c14-90d1-464f2239d8e7">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="c37f68d1-13c7-41a9-b7d1-ea01015e991e"/>
				</reportElement>
				<textFieldExpression><![CDATA[$F{proceso}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="287" y="38" width="100" height="30" uuid="0ef9adce-725a-4694-8d94-6836a1f13a5b">
					<property name="com.jaspersoft.studio.spreadsheet.connectionID" value="e383cc21-cf8a-4269-88e0-87cb416c8e9b"/>
				</reportElement>
				<textFieldExpression><![CDATA[$F{total}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band splitType="Stretch"/>
	</pageFooter>
	<summary>
		<band height="32" splitType="Stretch"/>
	</summary>
</jasperReport>
